{% extends 'base.html' %}

{% block title %}–ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å ‚Äî –ì—Ä–∞–ª—å–Ω–∞ –ö–æ–º–æ—Ä–∞{% endblock %}

{% block content %}

{% include 'components/admin/add_item.html' %}
{% include 'components/admin/edit_item.html' %}
{% include 'components/admin/add_news.html' %}
{% include 'components/admin/edit_news.html' %}
{% include 'components/admin/edit_user.html' %}
{% include 'components/admin/order_info.html' %}

<div class="container mt-4">

    <h2 class="fw-bold text-warning mb-4">‚öôÔ∏è –ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å</h2>

    <!-- NAV TABS -->
    <ul class="nav nav-tabs mb-4" id="adminTabs">
        <li class="nav-item">
            <a class="nav-link active" data-bs-toggle="tab" href="#items">üé≤ –¢–æ–≤–∞—Ä–∏</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#news">üì∞ –ù–æ–≤–∏–Ω–∏</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#orders">üßæ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#users">üë• –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ</a>
        </li>
    </ul>

    <div class="tab-content">

    <!-- Modal: Generic confirm action (used for delete item/news/user) -->
    <div class="modal fade" id="confirmActionModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content border border-warning">
                <div class="modal-header bg-body-tertiary text-warning">
                    <h5 class="modal-title">–ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è</h5>
                    <button type="button" class="btn-close bg-light" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body bg-body-tertiary">
                    <p id="confirmActionText">–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–∫–æ–Ω–∞—Ç–∏ —Ü—é –¥—ñ—é?</p>
                </div>
                <div class="modal-footer bg-body-tertiary">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
                    <button type="button" id="confirmActionBtn" class="btn btn-danger">–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏</button>
                </div>
            </div>
        </div>
    </div>

        <!-- ========================= -->
        <!-- üé≤ –¢–û–í–ê–†–ò -->
        <!-- ========================= -->
        <div id="items" class="tab-pane fade show active">
            <h4 class="fw-bold text-warning mb-3">üé≤ –¢–æ–≤–∞—Ä–∏</h4>

            <button class="btn btn-warning mb-3 fw-bold" data-bs-toggle="modal" data-bs-target="#addItemModal">
                ‚ûï –î–æ–¥–∞—Ç–∏ —Ç–æ–≤–∞—Ä
            </button>

            <div class="row">
                {% for item in items %}
                <div class="col-md-4 mb-3">
                    <div class="card border border-warning shadow-sm">
                        <img src="{{ url_for('static', filename=item.image) }}" class="card-img-top" style="height: 200px; object-fit: cover;">
                        <div class="card-body">
                            <h5 class="card-title text-warning fw-bold">{{ item.name }}</h5>
                            <p class="card-text small">{{ item.description[:80] }}...</p>
                            <p class="fw-bold">{{ item.price }} ‚Ç¥</p>

                            <div class="d-flex justify-content-between">
                                <a href="#" class="btn btn-outline-warning btn-sm edit-btn" data-id="{{ item.id }}">‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏</a>
                                <button class="btn btn-outline-danger btn-sm delete-btn" data-id="{{ item.id }}">
                                    üóëÔ∏è
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                {% else %}
                <p class="text-muted">–ù–µ–º–∞—î —Ç–æ–≤–∞—Ä—ñ–≤.</p>
                {% endfor %}
            </div>
        </div>

        <!-- ========================= -->
        <!-- üì∞ –ù–û–í–ò–ù–ò -->
        <!-- ========================= -->
        <div id="news" class="tab-pane fade">
            <h4 class="fw-bold text-warning mb-3">üì∞ –ù–æ–≤–∏–Ω–∏</h4>

            <button class="btn btn-warning mb-3 fw-bold" data-bs-toggle="modal" data-bs-target="#addNewsModal">
                ‚ûï –î–æ–¥–∞—Ç–∏ –Ω–æ–≤–∏–Ω—É
            </button>

            <ul class="list-group">
                {% for item in news %}
                <li class="list-group-item d-flex justify-content-between">
                    <div>
                        <strong>{{ item.name }}</strong>
                        <br>
                        <span class="text-muted small">ID: {{ item.id }}</span>
                    </div>
                    <div>
                        <button class="btn btn-outline-warning btn-sm edit-news-btn" 
                            data-id="{{ item.id }}">
                            ‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏
                        </button>

                        <button class="btn btn-outline-danger btn-sm delete-news-btn"
                                data-id="{{ item.id }}">üóëÔ∏è</button>
                    </div>
                </li>
                {% else %}
                <p class="text-muted">–ù–æ–≤–∏–Ω –Ω–µ–º–∞—î.</p>
                {% endfor %}
            </ul>
        </div>

        <!-- ========================= -->
        <!-- üßæ –ó–ê–ú–û–í–õ–ï–ù–ù–Ø -->
        <!-- ========================= -->
        <div class="tab-pane fade" id="orders">
            <h3 class="text-warning mb-4">üßæ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è</h3>

            <div class="table-responsive">
                <table class="table table-bordered align-middle">
                    <thead class="table-warning">
                        <tr class="text">
                            <th>ID</th>
                            <th>–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                            <th>–°—É–º–∞</th>
                            <th>–ö–µ—Ä—É–≤–∞–Ω–Ω—è</th>
                        </tr>
                    </thead>
                    <tbody>

                        {% for order in orders %}
                        <tr>
                            <td>#{{ order.id }}</td>

                            <td>
                                {{ order.user.nickname }} –ü—Ä–∏–≤—ñ–ª–µ–≥—ñ—è - <span class="badge bg-warning">{{ order.user.privilege_label }}</span><br>
                                <small class="text-muted">{{ order.user.email }}</small>
                            </td>

                            <td>
                                <span class="badge bg-info">{{ order.status }}</span>
                            </td>

                            <td>{{ order.total_sum }} –≥—Ä–Ω</td>

                            <td>
                                <button 
                                    class="btn btn-outline-warning btn-sm view-order-btn"
                                    data-id="{{ order.id }}">
                                    üîç –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏
                                </button>
                            </td>
                        </tr>
                        {% endfor %}

                    </tbody>
                </table>
            </div>
        </div>

        <!-- ========================= -->
        <!-- üë• –ö–û–†–ò–°–¢–£–í–ê–ß–Ü -->
        <!-- ========================= -->
        <div id="users" class="tab-pane fade">
            <h4 class="fw-bold text-warning mb-3">üë• –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ</h4>

            <ul class="list-group">
                {% for user in users %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <div>
                        <strong>{{ user.nickname }}</strong> ‚Äî <span class="text-muted small">{{ user.email }}</span> User ID: {{ user.id }}
                        <br>
                        –°—Ç–∞—Ç—É—Å: <span class="badge bg-info">{{ user.status }}</span>,
                        –ü—Ä–∏–≤—ñ–ª–µ–≥—ñ—è: <span class="badge bg-warning">{{ user.privilege_label }}</span>
                    </div>
                    <div>
                        <button class="btn btn-outline-warning btn-sm edit-user-btn" data-id="{{ user.id }}">
                            ‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏
                        </button>
                        <button class="btn btn-outline-danger btn-sm delete-user-btn" data-id="{{ user.id }}">
                            üóëÔ∏è
                        </button>
                    </div>
                </li>
                {% else %}
                <p class="text-muted">–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –Ω–µ–º–∞—î.</p>
                {% endfor %}
            </ul>
        </div>

    </div>
</div>
{% endblock %}
